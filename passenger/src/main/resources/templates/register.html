<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>系统注册</title>
    <link href="/css/style.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" type="text/css" href="/css/sweetalert.css">
    <script language="JavaScript" src="/js/jquery.js"></script>
    <script src="/js/sweetalert.min.js"></script>
    <script src="/js/cloud.js" type="text/javascript"></script>
    <style type="text/css">
        .user_login{width:255px; height:30px;border:none;  padding-left:24px; font-size:14px; color:#90a2bc;}
    </style>
    <script language="javascript">
        $(function(){
            $('.loginbox').css({'position':'absolute','left':($(window).width()-692)/2});
            $(window).resize(function(){
                $('.loginbox').css({'position':'absolute','left':($(window).width()-692)/2});
            });
        });
    </script>
</head>
<body style="background-color:#1c77ac; background-image:url(/images/light.png); background-repeat:no-repeat; background-position:center top; overflow:hidden;">
<div id="mainBody">
    <div id="cloud1" class="cloud"></div>
    <div id="cloud2" class="cloud"></div>
</div>
<div class="loginbody">
    <span class="systemlogo"></span>
        <form id="userForm" action="/user/register" method="post" style="float: left;padding-left: 39%;padding-top: 20px;">
            <ul>
                <span th:text="${msg}" id="message" style="color: red;font-size: 10px;"></span>
                <li style="height: 24px">
                    <input id="name" name="name" type="text" class="user_login"  placeholder="用户账号"/>
                    <span id="name_prompt" style="color: red;font-size: 12px;float: right;padding-top: 5px;padding-left: 10px;"></span>
                </li>
                <li style="margin-top: 15px;height: 24px">
                    <input id="nickname" name="nickname" type="text" class="user_login" placeholder="用户名称"/>
                    <span id="nickname_prompt" style="color: red;font-size: 12px;float: right;padding-top: 5px;padding-left: 10px;"></span>
                </li>
                <li style="margin-top: 15px;height: 24px">
                    <input id="pwd" name="pwd" type="password" class="user_login" placeholder="密码"/>
                    <span id="pwd_prompt" style="color: red;font-size: 12px;float: right;padding-top: 5px;padding-left: 10px;"></span>
                </li>
                <li style="margin-top: 15px;height: 24px">
                    <input id="confirmPwd" type="password" class="user_login" placeholder="确认密码"/>
                    <span id="confirmPwd_prompt" style="color: red;font-size: 12px;float: right;padding-top: 5px;padding-left: 10px;"></span>
                </li>
                <li style="margin-top: 15px;height: 24px">
                    <select id="departmentID" name="departmentID" class="user_login" style="width: 279px">
                        <option>请选择部门</option>
                        <option th:each="department:${departmentList}" th:value="${department.id}" th:text="${department.name}"></option>
                    </select>
                    <span id="department_prompt" style="color: red;font-size: 12px;float: right;padding-top: 5px;padding-left: 10px;"></span>
                </li>
                <li style="margin-top: 15px;height: 24px">
                    <input id="tel" name="tel" type="text" class="user_login"  placeholder="手机号码"/>
                    <span id="tel_prompt" style="color: red;font-size: 12px;float: right;padding-top: 5px;padding-left: 10px;"></span>
                </li>
                <li style="margin-top: 15px;height: 24px">
                    <input id="email" name="email" type="text" class="user_login"  placeholder="Email"/>
                    <span id="email_prompt" style="color: red;font-size: 12px;float: right;padding-top: 5px;padding-left: 10px;"></span>
                </li>
                <li style="margin-top: 20px;height: 24px">
                    <input type="button" class="loginbtn" id="register" value="注册"/>
                    <label><a style="cursor:pointer;color: gray" href="/user/login">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                        &nbsp;&nbsp;&nbsp;&nbsp;已有账号 去登陆</a></label>
                </li>
            </ul>
        </form>
</div>
<div class="loginbm">
    <img src="/images/login.png" style="width: 25px;vertical-align: middle;">&nbsp;
    版权所有  深圳市北海轨道交通技术有限公司 ，勿用于任何商业用途
</div>
<script language="JavaScript" src="/js/jquery.js"></script>
<script type="text/javascript">
    $("#register").click(function () {
        if(isnull()){
            var nickname=$("#nickname").val();
            var name=$("#name").val();
            var pwd=$("#pwd").val();
            var tel=$("#tel").val();
            var email=$("#email").val();
            var departmentID=$("#departmentID").val();
            $.ajax({
                url:'/user/userRegister',
                type:"POST",
                data:{nickname:nickname,name:name,pwd:pwd,tel:tel,email:email,departmentID:departmentID},
                success:function (data) {
                    if(data.result=="exit"){
                        swal("该用户名已存在!");
                    }else if(data.result=="success"){
                        swal("Good!", "操作成功", "success");
                        $(".confirm").click(function () {
                            location.href="/user/login";
                        });
                    }else{
                        swal("OMG!", "操作错误", "error");
                    }
                },
                error:function (){
                    swal("OMG!", "请求失败!", "error");
                }
            });
        }
    });

    function isnull(){
        var nickname=$("#nickname").val();
        var name=$("#name").val();
        var pwd=$("#pwd").val();
        var confirmPwd=$("#confirmPwd").val();
        var email=$("#email").val();
        var tel=$("#tel").val();
        var departmentID=$("#departmentID").val();
        var name_reg=new RegExp("^([a-zA-Z0-9]{4,12})$");//用户名由英文字母，数字组成的4-12位字符
        var pwd_reg=new RegExp("^[a-zA-Z][a-zA-Z0-9]{5,17}$");  //密码由英文字母和数字组成的6-18位字符，以字母开头
        var email_reg = new RegExp("^[a-z0-9A-Z]+[- | a-z0-9A-Z . _]+@([a-z0-9A-Z]+(-[a-z0-9A-Z]+)?\\.)+[a-z]{2,}$");
        var tle_reg=new RegExp("^1(3|4|5|7|8)\\d{9}$");

        if(name=="" || name.match(/^\s+$/g)){
            $("#name_prompt").html("账号不能为空");
            return false;
        }else if(!name_reg.test(name)){
            $("#name_prompt").html("账号由英文字母，数字组成的4-12位字符组成");
            return false;
        }else{
            $("#name_prompt").html("");
        }

        if(nickname=="" || nickname.match(/^\s+$/g)){
            $("#nickname_prompt").html("用户名称不能为空");
            return false;
        }else if(nickname.length>16){
            $("#nickname_prompt").html("用户名称长度不能大于16位");
            return false;
        }else{
            $("#nickname_prompt").html("");
        }

        if(pwd=="" || pwd.match(/^\s+$/g)){
            $("#pwd_prompt").html("密码不能为空");
            return false;
        }else if(!pwd_reg.test(pwd)){
            $("#pwd_prompt").html("密码以字母开头，不能含有非法字符，长度在6-18之间");
            return false;
        }else{
            $("#pwd_prompt").html("");
        }

        if(confirmPwd=="" || confirmPwd.match(/^\s+$/g)){
            $("#confirmPwd_prompt").html("二次密码不能为空");
            return false;
        }else if(confirmPwd!=pwd){
            $("#confirmPwd_prompt").html("二次密码不一致");
            return false;
        }else{
            $("#confirmPwd_prompt").html("");
        }

        if (departmentID=="" || departmentID==null){
            $("#department_prompt").html("请先选择部门!");
            return false;
        }else{
            $("#department_prompt").html("");
        }

        if(tel=="" || tel.match(/^\s+$/g)){
            $("#tel_prompt").html("手机号码不能为空");
            return false;
        }else if(!tle_reg.test(tel)){
            $("#tel_prompt").html("手机号码不正确，请重新输入");
            return false;
        }else{
            $("#tel_prompt").html("");
        }

        if(email=="" || email.match(/^\s+$/g)){
            $("#email_prompt").html("Email不能为空");
            return false;
        }else if(!email_reg.test(email)){
            $("#email_prompt").html("Email格式不正确，例如web@sohu.com");
            return false;
        }else{
            $("#email_prompt").html("");
        }
        return true;
    }
</script>
</body>
</html>
