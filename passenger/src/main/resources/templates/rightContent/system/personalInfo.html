<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>个人信息</title>
    <style>
        #user_div {
            height: 215px;
            border: 1px solid #006c96;
        }

        #user_title {
            font-size: 14px;
            font-weight: bolder;
            background-color: #006c96;
            color: white;
            margin: auto;
            height: 20px;
            padding-left: 10px;
            padding-top: 10px;
            padding-bottom: 10px;
        }

        #preservation_div {
            padding-left: 260px;
            padding-top: 20px;
        }

        #preservation_div input {
            width: 80px;
        }

        table {
            table-layout: fixed;
            border-collapse: collapse;
            text-align: center;
        }

        tbody {
            height: 377px;
            display: block;
            overflow-y: auto;
            width: 100%;
            table-layout: fixed;
        }

        tr {
            display: table;
            width: 100%;
            table-layout: fixed;
        }

        td {
            font-size: 12px;
            height: 30px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
    </style>
    <script src="/js/sweetalert.min.js"></script>
    <link rel="stylesheet" type="text/css" href="/css/sweetalert.css">
</head>
<body>
<div id="user_div">
    <p id="user_title">个人信息</p>
    <input type="text" id="userId" th:value="${users.id}" hidden="hidden">
    <table width="100%" border="0" id="userTable">
        <tr>
            <td>用户名称:</td>
            <td><input type="text" id="nickname" th:value="${users.nickname}"></td>
            <td>Tel:</td>
            <td><input type="text" id="tel" th:value="${users.tel}"></td>
        </tr>
        <tr>
            <td>密码:</td>
            <td><input type="password" id="pwd"></td>
            <td>确认密码:</td>
            <td><input type="password" id="confirmPwd"></td>
        </tr>
        <tr>
            <td>邮箱:</td>
            <td><input type="text" id="email" th:value="${users.email}"></td>
            <td>创建人:</td>
            <td><input type="text"></td>
        </tr>
    </table>
</div>
<div id="preservation_div">
    <input type="button" id="userOperation" value="保存">
</div>

<script language="JavaScript" src="/js/jquery.js"></script>
<script type="text/javascript">
    $(document).ready(function () {
        $("#userOperation").click(function () {
            var userId = $("#userId").val();
            var nickname = $("#nickname").val();
            var pwd = $("#pwd").val();
            var tel = $("#tel").val();
            var email = $("#email").val();
            if (isnull()) {
                $.ajax({
                    url: '/user/updateUser',
                    type: "POST",
                    data: {id: userId, nickname: nickname, tel: tel, email: email, pwd: pwd},
                    success: function (data) {
                        if (data.result == "success") {
                            swal("Good!", "操作成功!", "success");
                            $(".confirm").click(function () {
                                location.href = "/user/userInformation";
                            });
                        } else {
                            swal("OMG!", "操作错误!", "error");
                        }
                    },
                    error: function () {
                        swal("OMG!", "请求失败!", "error");
                    }
                });
            }
        });
    });

    function isnull() {
        var nickname = $("#nickname").val();
        var pwd = $("#pwd").val();
        var confirmPwd = $("#confirmPwd").val();
        var tel = $("#tel").val();
        var email = $("#email").val();

        var pwd_reg = new RegExp("^[a-zA-Z][a-zA-Z0-9]{5,17}$");  //密码由英文字母和数字组成的6-18位字符，以字母开头
        var email_reg = new RegExp("^[a-z0-9A-Z]+[- | a-z0-9A-Z . _]+@([a-z0-9A-Z]+(-[a-z0-9A-Z]+)?\\.)+[a-z]{2,}$");
        var tle_reg = new RegExp("^1(3|4|5|7|8)\\d{9}$");

        if (nickname == "" || nickname.match(/^\s+$/g)) {
            swal("测试");
            return false;
        }

        if (pwd != "") {
            if (!pwd_reg.test(pwd)) {
                swal("密码以字母开头，不能含有非法字符，长度在6-18之间");
                return false;
            }
            if (confirmPwd != pwd) {
                swal("二次密码不一致");
                return false;
            }
        }

        if (tel == "" || tel.match(/^\s+$/g)) {
            swal("手机号码不能为空");
            return false;
        } else if (!tle_reg.test(tel)) {
            swal("手机号码不正确，请重新输入");
            return false;
        }

        if (email == "" || email.match(/^\s+$/g)) {
            swal("Email不能为空");
            return false;
        } else if (!email_reg.test(email)) {
            swal("Email格式不正确，例如web@sohu.com");
            return false;
        }
        return true;
    }
</script>
</body>
</html>