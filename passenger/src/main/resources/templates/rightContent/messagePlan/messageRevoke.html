<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="/css/css.css"/>
    <style>
        #messageRevoke_title {
            font-size: 14px;
            font-weight: bolder;
            background-color: #006c96;
            color: white;
            margin: auto;
            height: 20px;
            padding-left: 10px;
            padding-top: 10px;
            padding-bottom: 10px;
        }

        #messageRevoke_height_div {
            width: 79.5%;
            height: 515px;
            border: 1px solid wheat;
            margin: 0 auto;
            overflow: auto
        }

        #messageRevoke_line_div {
            height: 515px;
            float: left;
            border: 1px solid wheat;
            width: 20%;
            overflow: auto;
        }

        #revokeMessage {
            width: 60px;
            height: 25px
        }

        .tips {
            border: 1px solid #ccc;
            font-weight: bolder;
            font-size: 14px;
            height: 30px;
        }

        table {
            table-layout: fixed;
            border-collapse: collapse;
            text-align: center;
        }

        tbody {
            overflow-y: auto;
            width: 100%;
            table-layout: fixed;
        }

        tr {
            width: 100%;
            table-layout: fixed;
        }

        td {
            font-size: 12px;
            height: 30px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        tr.on td {
            background-color: #BFEFFF;
        / 背景颜色 /
        }

        .f-treeList-old {
            float: left;
            width: 14px;
            height: 19px;
            cursor: pointer;
            margin-top: 7px;
        }

        .f-treeList-titleImg {
            float: left;
            margin-top: 4px;
            margin-left: 0px;
        }

        .f-treeList-titleP {
            display: block;
            float: left;
            line-height: 26px;
        }

        .f-iconBi {
            width: 30px;
            margin-left: -6px
        }

        .f-treeList-radio {
            display: block;
            margin-right: 2px;
            margin-top: 5px;
        }

        #paging_ul {
            list-style: none;
            margin: auto;
            padding: 0px;
            padding-left: 32px;
            padding-top: 7px;
            text-align: center
        }
    </style>
    <script src="/js/sweetalert.min.js"></script>
    <link rel="stylesheet" type="text/css" href="/css/sweetalert.css">
    <script type="text/javascript" src="/js/tabSize.js"></script>
    <script type="text/javascript">
        window.onload = function () {
            tabSize.init('messageRevokeTable');
        };
    </script>
</head>
<body>
<p id="messageRevoke_title">消息撤销</p>
<div id="messageRevoke_line_div">
    <div>
        <div class="f-maintenance"></div>
    </div>
</div>
<div id="messageRevoke_height_div">
    <div style="overflow: auto;height: 505px">
        <table width="100%" border="0" id="messageRevokeTable">
            <thead>
            <tr>
                <th class="tips">消息内容</th>
                <th class="tips" style="width: 15%">操作</th>
            </tr>
            </thead>
            <tr th:each="message:${messageList}">
                <td th:text="${message.msg}"></td>
                <td><input type="button" value="撤销" id="revokeMessage"></td>
            </tr>
        </table>
    </div>
</div>
<script type="text/javascript" src="/js/config.js"></script>
<script type="text/javascript" src="/js/jquery.min.js"></script>
<script type="text/javascript">
    $(document).ready(function () {
        $("#messageRevokeTable tbody").on("click", 'tr', function () { //给每个tr 绑定点击事件 主要锁定每个tr
            var trs = $(this).parent().find('tr'); //获取所有tr
            if (trs.hasClass('on')) { //判断这些tr 有没有Class ‘on’’
                trs.removeClass('on');//把class on 移除
            }
            $(this).addClass('on');//点击的tr 添加 on class 用于改变样式
        });

        $.ajax({
            url: '/Line/getMenu',
            type: "POST",
            data: {type: 1},
            success: function (data) {
                var treeData = [
                    /*{id:1,title:'轨道交通乘客信息系统',route:'javascript:void(0);',pid:0}*/
                ];
                var count = 0;
                $.each(data.lineVoList, function (i, item) {
                    count++;
                    var one = count;
                    treeData.push({id: count, title: item.name, oid: item.id, route: 'javascript:void(0);', pid: 0});
                    $.each(item.stationVoList, function (j, itemOne) {
                        count++;
                        var two = count;
                        if (item.id == itemOne.lineID) {
                            treeData.push({
                                id: count,
                                title: itemOne.name,
                                oid: itemOne.id,
                                route: 'javascript:void(0);',
                                pid: one
                            });
                        }
                        $.each(itemOne.deviceList, function (k, itemTwo) {
                            count++;
                            if (itemOne.id == itemTwo.stationID) {
                                treeData.push({
                                    id: count,
                                    title: itemTwo.name,
                                    oid: itemTwo.id,
                                    deviceNumber: itemTwo.id,
                                    route: 'javascript:void(0);',
                                    pid: two
                                });
                            }
                        });
                    });
                });
                config.tree({
                    type: 1,//1有选择框，没有则不传type或传0
                    wrapper: '.f-maintenance',//容器
                    data: treeData,//数据
                });
            }
        });

        $("#revokeMessage").click(function () {
            var msg = $(this).closest("tr").find("td").eq(0).text();
            var deviceID = null;
            var deviceList = $(".f-iconRadioTrue").siblings(".deviceID");
            if (deviceList.length == 0) {
                swal("请选择设备!");
                return false;
            }
            for (var i = 0; i < deviceList.length; i++) {
                if (deviceList[i].value != 'undefined' && deviceList[i].value != null) {
                    deviceID = deviceList[i].value;
                    $.ajax({
                        url:'/message/revokeMessage',
                        type:"POST",
                        data:{deviceID:deviceID,msg:msg},
                        success:function (data) {
                            if(data.result=="success"){
                                swal("Good!", "操作成功!", "success");
                                $(".confirm").click(function () {
                                    location.href="/message/messageRevokeManagement";
                                });
                            }else{
                                swal("OMG!", "操作错误!", "error");
                            }
                        }
                    });
                }
            }
        });
    });
</script>
</body>
</html>