<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>
    <style>
        .order_details{margin-top:30px;}
        .order_details ul{margin:0px;padding:0px;border-bottom: 1px solid #b4b4b4;position: relative;}
        .order_details ul li{float: left;display: block;width: 80px;position: absolute;top:-24px;text-align: center;font-size: 17px;color: #2077d6}
        .order_details .checked{background-color: #fff;color: #636363;border:1px solid #b4b4b4;border-bottom:0 ;}
      /*  .prepaids{position: absolute;}
        .prepaids2{position: absolute;left:83px;}
        .hidedomdiv{display: none}
        .showdomdiv{display: block;}
        .showsss{border:1px solid #efe4e4;width: 99.8%;height: 566px;}*/
        .user_management{height: 215px;width: 99%;border:1px solid #006c96;margin-top: 8px;margin-left: 4px;}
        .journal_title{font-size: 14px;font-weight: bolder;background-color: #006c96;color: white;
            margin: auto;height: 20px;padding-left: 10px;padding-top: 10px;padding-bottom: 10px;}
        .information_div{padding-top: 15px;margin: auto;}
        .information_div label{padding-left: 80px;}
        .Preservation_div{padding-left: 260px;padding-top: 20px;}
        .Preservation_div input{width: 80px;}
        .select_div{height: 125px;margin: auto;}
        .select_div div{float: left;padding-top: 32px;padding-left: 70px;}
        #userInformation_footer{height: 451px;width: 99%;border: 1px solid #ebf2f5;
            margin-top: 10px;margin-left: 5px;}
        #userInformation_footer p{font-size: 14px;font-weight: bolder;background-color: #006c96;color: white;
            margin: auto;height: 20px;padding-left: 10px;padding-top: 10px;padding-bottom: 10px;}
        .tips{border:1px solid #ccc;font-weight: bolder;font-size: 14px;height: 30px;}
        table{ table-layout:fixed; border-collapse:collapse;text-align: center;}
        tbody {height:376px;display: block;overflow-y:auto;width: 100%;table-layout: fixed;}
        tr {display: table;width: 100%; table-layout: fixed;}
        td{ font-size: 12px;height: 30px; white-space:nowrap;overflow:hidden;text-overflow: ellipsis;}
        tr.on td{ background-color: #BFEFFF; / 背景颜色/}
        #paging_ul{list-style: none;margin: auto;padding: 0px;padding-left: 32px;padding-top: 7px;}
        #paging_ul li{display: inline;float:left;width: 69px;}
        #nextPage{margin-left: -32px;}
    </style>
    <script src="/js/sweetalert.min.js"></script>
    <link rel="stylesheet" type="text/css" href="/css/sweetalert.css">
</head>
<body>
<!--<div class="order_details">-->
<!--    <ul>-->
<!--        <li class="fortab prepaids checked">个人信息</li>-->
<!--        <li class="fortab prepaids2">用户信息</li>-->
<!--    </ul>-->
<!--</div>-->
<!--<div>-->
    <!--<div class="tablelist showdomdiv showsss">
        <div class="user_management">
            <p>用户管理</p>
            <input type="text" class="userId" hidden="hidden" th:value="${users.id}">
            <div class="information_div">
                <label>用户姓名:</label>
                <input type="text" class="userName" th:value="${users.name}">
                <label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    账号:</label>
                <input type="text">
            </div>
            <div class="information_div">
                <label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    密码:</label>
                <input type="text">
                <label> &nbsp;确认密码:</label>
                <input type="text">
            </div>
            <div class="information_div">
                <label>&nbsp;&nbsp; 所属组:</label>
                <input type="text">
                <label>车站/中心:</label>
                <input type="text">
            </div>
            <div class="information_div">
                <label>&nbsp;&nbsp; 创建人:</label>
                <input type="text">
                <label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    描述:</label>
                <input type="text" class="des" th:value="${users.des}">
            </div>
        </div>
        <div class="Preservation_div"><input type="button" value="保存"></div>
    </div>-->
    <div class="tablelist hidedomdiv showsss">
        <div class="select_div">
            <p class="journal_title">用户信息管理</p>
            <div>
                <label>用户名称:</label>
                <input type="text" class="username">
            </div>
            <div><input style="width: 80px;" onclick="selectUserByName();" type="button" value="查询" ></div>
            <div><input style="width: 80px;"  type="button" id="addPage" value="添加用户" ></div>
        </div>
        <div id="userInformation_footer">
            <table width="100%" border="0" id="table">
                <thead>
                <tr>
                    <th class="tips">用户名</th>
                    <th class="tips">邮箱</th>
                    <th class="tips">电话</th>
                    <th class="tips">描述</th>
                    <th class="tips">操作</th>
                </tr>
                </thead>
                <tr>
                </tr>
            </table>
            <div id="paging_div">
                <ul id="paging_ul">

                </ul>
            </div>
        </div>
    </div>
<!--</div>-->
<script language="JavaScript" src="/js/jquery.js"></script>
<script type="text/javascript">
$(document).ready(function(){
    selectUserByName();
    $("#upButton").live("click",function () {
        var str = $(this).val()=="修改"?"确定":"修改";
        $(this).val(str);   // 按钮被点击后，在“编辑”和“确定”之间切换

        if($(this).val()=="确定"){
            $(this).closest("tr").find(".td_text").dblclick(function() {
                var input = "<input type='text' id='temp' value=" + $(this).text() + " >";
                $(this).text("");
                $(this).append(input);
                $("input#temp").focus();
                $("input").blur(function () {
                    if ($(this).val() == "") {
                        $(this).remove();
                    } else {
                        $(this).closest("td").text($(this).val());
                    }
                });
            });
        }else{
            var id=$(this).closest("tr").find("td").eq(0).text();
            var name=$(this).closest("tr").find("td").eq(1).text();
            var email=$(this).closest("tr").find("td").eq(2).text();
            var tel=$(this).closest("tr").find("td").eq(3).text();
            var des=$(this).closest("tr").find("td").eq(4).text();
            if(name==""){
                swal("用户名不能为空");
                return false;
            }
            if(email==""){
                swal("邮箱不能为空");
                return false;
            }
            if(tel==""){
                swal("电话不能为空");
                return false;
            }
            if(des==""){
                swal("描述不能为空");
                return false;
            }

            $.ajax({
                url:'/user/updateUser',
                type:"POST",
                data:{id:id,name:name,email:email,tel:tel,des:des},
                success:function (data) {
                    if(data.result=="success"){
                        swal("Good!", "操作成功!", "success");
                        $(".confirm").click(function () {
                            selectUserByName();
                        });
                    }else{
                        swal("OMG!", "操作错误!", "error");
                    }
                },
                error:function (){
                    swal("OMG!", "请求失败!", "error");
                }
            });

        }

    });

    $(".Preservation_div").click(function () {
        var id=$(".userId").val();
        var name=$(".userName").val();
        var des=$(".des").val();
        $.ajax({
            url:'/user/updateUser',
            type:"POST",
            data:{id:id,name:name,des:des},
            success:function (data) {
                if(data.result=="success"){
                    swal("Good!", "操作成功!", "success");
                    $(".confirm").click(function () {
                        window.location.href="/user/userManagement";
                    });
                }else{
                    swal("OMG!", "操作错误!", "error");
                }
            },
            error:function (){
                swal("OMG!", "请求失败!", "error");
            }
        });
    });

    $("tbody tr").live("click",function(){
        var trs = $(this).parent().find('tr'); //获取所有tr
        if(trs.hasClass('on')){ //判断这些tr 有没有Class ‘on’’
            trs.removeClass('on');//把class on 移除
        }
        $(this).addClass('on');//点击的tr 添加 on class 用于改变样式
        myRows=$(this).find("td");
    });
    // 改为鼠标移上的事件只需把click改为mousemove
    $(".fortab").click(function(){
        var number=$(".fortab").index(this);
        $(this).addClass("checked");
        $(this).siblings().removeClass("checked");
        $(".tablelist:eq("+number+")").show();
        $(".tablelist:eq("+number+")").siblings().hide();
    });

    $("#addPage").click(function () {
       location.href="/user/addUserManagement";
    });
});
function selectUserByName(pageNum) {
    $.ajax({
        url:'/user/selectUserByName',
        type:"POST",
        data:{username:$(".username").val(),pageNum:pageNum},
        success:function (data) {
            $("tbody tr").remove();
            $.each(data.pageUtil.pageData, function (i, item) {
                $("table tbody").prepend('<tr><td hidden="hidden">'+item.id+'</td>' +
                    '<td class="td_text">'+item.name+'</td>' +
                    '<td class="td_text">'+item.email+'</td>' +
                    '<td class="td_text">'+item.tel+'</td>' +
                    '<td class="td_text">'+item.des+'</td>' +
                    '<td class="td_text"><input id="upButton" type="button" value="修改"></td></tr>');
            });
            $("#paging_ul li").remove();
            $("#paging_ul").prepend('<li><span>当前页数:</span></li>' +
                '<li><span>'+data.pageUtil.pageNum+'</span>/<span>'+data.pageUtil.maxPage+'</span></li>');
            if(data.pageUtil.pageNum>=2){
                $(".notPreviousPage").remove();
                $("#paging_ul").prepend('<li><input type="button" value="上一页" class="isPreviousPage" onclick="previousPage('+data.pageUtil.pageNum+')"></li>');
            }else{
                $(".isPreviousPage").remove();
                $("#paging_ul").prepend('<li><input type="button" value="上一页" class="notPreviousPage" disabled="disabled"></li>');
            }

            if(data.pageUtil.pageNum<data.pageUtil.maxPage){
                $(".notNextPage").remove();
                $("#paging_ul").append('<li><input type="button" value="下一页" class="isNextPage" id="nextPage" onclick="nextPage('+data.pageUtil.pageNum+')"></li>');
            }else{
                $(".isNextPage").remove();
                $("#paging_ul").append('<li><input type="button" value="下一页" class="notNextPage" id="nextPage" disabled="disabled"></li>');
            }
        }
    });
}

function nextPage(pageNum) {
    var num=parseInt(pageNum)+1;
    selectUserByName(num);
}
function previousPage(pageNum) {
    var num=parseInt(pageNum)-1;
    selectUserByName(num);
}
</script>
</body>
</html>