<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style type="text/css">
        #material_top_div{height: 150px;width: 99%;border: 1px solid wheat;margin: auto}
        #material_right_div{height: 442px;width: 99%;border: 1px solid wheat;margin: auto}
        #material_ul{list-style: none;}
        #material_ul li{display: inline;float:left;width: 34%;font-size: 14px;height: 44px; margin-top: 25px;}
        #material_ul li span{padding-right: 10px;}
        #material_top_p{font-size: 14px;font-weight: bolder;background-color: #006c96;color: white;
            margin: auto;height: 20px;padding-left: 10px;padding-top: 10px;padding-bottom: 10px;}
        #material_right_p{font-size: 14px;font-weight: bolder;background-color: #006c96;color: white;
            margin: auto;height: 20px;padding-left: 10px;padding-top: 10px;padding-bottom: 10px;}
        #material_top_Button input{height: 27px;width: 72px}
        #material_footer_ul{list-style: none;}
        #material_footer_ul li{display: inline;float:left;width: 100%;font-size: 14px;height: 50px;}
        #material_footer_ul li span{padding-right: 10px;}
        #material_operation_div{padding-left: 90px;}
        #material_operation_div input{height: 25px;width: 90px;}
        #type,#state{height: 21px;width: 100px;}
        #material_select_div{margin-top: 40px;}
        .selectFodderButton{height: 25px;width: 80px;}
        .materialRadio{vertical-align: bottom;height: 15px;margin-left: -5px}
        .tips{border:1px solid #ccc;font-weight: bolder;font-size: 14px;height: 30px;}
        table{ table-layout:fixed; border-collapse:collapse;text-align: center;}
        tbody {height:327px;display: block;overflow-y:auto;width: 100%;table-layout: fixed;}
        tr {display: table;width: 100%; table-layout: fixed;}
        td{ font-size: 12px;height: 30px; white-space:nowrap;overflow:hidden;text-overflow: ellipsis;}
        tr.on td{ background-color: #BFEFFF; / 背景颜色/}
        .cont {
            display: none;
            position: fixed;
            top:5%;
            left: 20%;
            width: 50%;
            height: 70%;
            border: 1px solid #ddd;
            background-color: white;
            z-index:1;
            overflow: auto;
        }
        #paging_ul{list-style: none;margin: auto;padding: 0px;padding-left: 32px;}
        #paging_ul li{display: inline;float:left;width: 69px;}
        .nextPage{margin-left: -32px;}
    </style>
    <script src="/js/sweetalert.min.js"></script>
    <link rel="stylesheet" type="text/css" href="/css/sweetalert.css">
</head>
<body>
<div id="material_top_div">
    <p id="material_top_p">添加素材</p>
    <form id="uploadForm" method="post" action="/fodder/addMaterial" enctype="multipart/form-data">
        <ul id="material_ul">
            <li><span>添加素材:</span><input type="file" name="file" id="file" multiple="multiple"></li>
        </ul>
        <input type="type" name="size" id="size" hidden="hidden">
    </form>
    <div id="material_select_div">
        <select id="type">
            <option value="">全部</option>
            <option th:each="fodderType:${fodderTypeList}" th:value="${fodderType.type}" th:text="${fodderType.suffixName}"></option>
        </select>
        <select id="state">
            <option value="">全部</option>
            <option value="-1">审核不通过</option>
            <option value="0">未审核</option>
            <option value="1">审核通过</option>
        </select>
        <input type="type" class="name">
        <input type="button" class="selectFodderButton" value="查询">
    </div>
</div>
<div id="material_right_div">
    <p id="material_right_p">素材列表</p>
    <table width="100%" border="0" id="materialTable">
        <thead>
        <tr>
            <th class="tips">素材名称</th>
            <th class="tips">大小</th>
            <th class="tips">延迟</th>
            <th class="tips">状态</th>
            <th class="tips">操作</th>
        </tr>
        </thead>
        <tr th:each="fodder:${pageUtil.pageData}">
            <td th:text="${fodder.id}" hidden="hidden"></td>
            <td th:text="${fodder.name}"></td>
            <td th:text="${fodder.size}"></td>
            <td th:text="${fodder.note}"></td>
            <td th:if="${fodder.state} eq '-1'">审核不通过</td>
            <td th:if="${fodder.state} eq '0'">未审核</td>
            <td th:if="${fodder.state} eq '1'">审核通过</td>
            <td><input type="button" value="审核" id="updateButton">&nbsp;<input type="button" value="删除" id="deleteButton"></td>
        </tr>
    </table>
    <div id="paging_div">
        <ul id="paging_ul">
            <li><input th:if="${pageUtil.pageNum} ge '2'" type="button" value="上一页"  th:onclick="'javascript:previousPage(\''+${pageUtil.pageNum-1}+'\')'">
                <input th:if="${pageUtil.pageNum} le '1'" type="button" value="上一页" disabled="disabled"></li>
            <li><span>当前页数:</span></li>
            <li><span th:text="${pageUtil.pageNum}"></span>/<span th:text="${pageUtil.maxPage}"></span></li>
            <li><input th:if="${pageUtil.pageNum} lt ${pageUtil.maxPage}" type="button" value="下一页" class="nextPage" th:onclick="'javascript:nextPage(\''+${pageUtil.pageNum+1}+'\')'">
                <input th:if="${pageUtil.pageNum} ge ${pageUtil.maxPage}" type="button" value="下一页" class="nextPage" disabled="disabled"></li>
        </ul>
    </div>
</div>

<div id="cont_b" class="cont">
    <div id="material_footer_div">
        <input type="text" class="id" hidden="hidden">
        <ul id="material_footer_ul">
            <li style="height: 290px"><img src="" width="90%" height="260px" class="content"></li>
            <li><span>审核:</span>
                <span>审核不通过</span><input type="radio" name="materialState" value="-1" class="materialRadio">
                <span style="padding-left: 50px">审核通过</span><input type="radio" name="materialState" value="1" class="materialRadio"></li>
        </ul>
    </div>
    <div id="material_operation_div">
        <input id="updateFodder" type="button" value="保存">
        <input type="button" value="取消" onclick = "document.getElementById('cont_b').style.display='none'">
    </div>
</div>
<script language="JavaScript" src="/js/jquery.js"></script>
<script type="text/javascript">
$(document).ready(function(){

    $("#materialTable").find("tr").each(function(){
        var tdArr = $(this).children();
        var state = tdArr.eq(4).text();
        if(state=="审核不通过" || state=="审核通过"){
            $(this).children().eq(5).find("#updateButton").css('display','none');
        }
    });

    $("#file").change(function () {
        var fileObj = document.getElementById("file").files[0]; // js 获取文件对象
        var filesize = fileObj.size;
        $("#size").val(filesize);
        $("#uploadForm").submit();
    });

    $(".selectFodderButton").click(function () {
       var type=$("#type").val();
       var state=$("#state").val();
       var name=$(".name").val();
       location.href="/fodder/materialManagement?type="+type+"&state="+state+"&name="+name;
    });


    $("#updateButton").live("click",function () {
        document.getElementById('cont_b').style.display='block';
        //获取选中的值,传入输入框
        $(".id").val($(this).closest("tr").find("td").eq(0).text());
        $(".content").attr('src',$(this).closest("tr").find("td").eq(2).text());
    });

    $("#updateFodder").click(function () {
        var id=$(".id").val();
        var state=$('input[name="materialState"]:checked').val();
        $.ajax({
            url:'/fodder/updateFodderState',
            type:"POST",
            data:{id:id,state:state},
            success:function (data) {
                if(data.result=="success"){
                    swal("Good!", "操作成功!", "success");
                    $(".confirm").click(function () {
                        window.location.href="/fodder/materialManagement";
                    });
                }else{
                    swal("OMG!", "操作错误!", "error");
                }
            },
            error:function (){
                swal("OMG!", "请求失败!", "error");
            }
        });
    });

    $("#deleteButton").live("click",function () {
        var id=$(this).closest("tr").find("td").eq(0).text();
        swal({
            title: "您确定要删除吗？",
            text: "您确定要删除这条数据？",
            type: "warning",
            showCancelButton: true,
            closeOnConfirm: false,
            confirmButtonText: "是的，我要删除",
            confirmButtonColor: "#ec6c62"
        }, function() {
            $.ajax({
                url:'/fodder/deleteMaterial',
                type:"POST",
                data:{id:id},
                success:function (data) {
                    if(data.result=="success"){
                        swal("Good!", "操作成功!", "success");
                        $(".confirm").click(function () {
                            window.location.href="/fodder/fodderManagement";
                        });
                    }else{
                        swal("OMG!", "操作错误!", "error");
                    }
                },
                error:function (){
                    swal("OMG!", "请求失败!", "error");
                }
            });
        });
    });

    $("#materialTable tr").live("click",function(){
        var trs = $(this).parent().find('tr'); //获取所有tr
        if(trs.hasClass('on')){ //判断这些tr 有没有Class ‘on’’
            trs.removeClass('on');//把class on 移除
        }
        $(this).addClass('on');//点击的tr 添加 on class 用于改变样式
    });
});
function nextPage(pageNum) {
    location.href="/fodder/materialManagement?pageNum="+pageNum;
}
function previousPage(pageNum) {
    location.href="/fodder/materialManagement?pageNum="+pageNum;
}
</script>
</body>
</html>