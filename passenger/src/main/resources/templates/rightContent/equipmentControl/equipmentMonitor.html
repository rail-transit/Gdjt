<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style type="text/css">
        .order_details{margin-top:25px;}
        .order_details ul{margin:0px;padding:0px;border-bottom: 1px solid #b4b4b4;position: relative;}
        .order_details ul li{float: left;display: block;width:118px;position: absolute;top:-24px;text-align: center;font-size: 17px;color: #2077d6}
        .order_details .checked{background-color: #fff;color: #636363;border:1px solid #b4b4b4;border-bottom:0 ;}
        .prepaids{position: absolute;}
        .prepaids2{position: absolute;left:122px;}
        .hidedomdiv{display: none}
        .showdomdiv{display: block;}
        .showsss{margin: auto;padding: 0px;border: 1px solid #46657b}
        #mapMonitor_div{height: 570px;width: 100%;}
        #listMonitor_div{height: 570px;width: 100%;}
        #listMonitor_top{height: 80px;width: 99%;border: 1px solid #46657b;margin: auto}
        #listMonitor_ul{list-style: none;padding-top: 2px;}
        #listMonitor_ul li{display: inline;float:left;width: 11%;font-size: 14px;}
        #listMonitor_ul li select{height: 20px;width: 110px;margin-left: -35px}
        .tips{border:1px solid #ccc;font-weight: bolder;font-size: 14px;height: 30px;}
        table{ table-layout:fixed; border-collapse:collapse;text-align: center;}
        tbody {height:415px;display: block;overflow-y:auto;width: 100%;table-layout: fixed;}
        tr {display: table;width: 100%; table-layout: fixed;}
        td{ font-size: 12px;height: 30px; white-space:nowrap;overflow:hidden;text-overflow: ellipsis;}
        tr.on td{ background-color: #BFEFFF; / 背景颜色/}
        #paging_ul{list-style: none;margin: auto;padding: 0px;padding-left: 32px;padding-top: 7px;}
        #paging_ul li{display: inline;float:left;width: 69px;}
        #nextPage{margin-left: -32px;}
    </style>
</head>
<body>
<div class="order_details">
    <ul>
        <li class="fortab prepaids checked">地图显示</li>
        <li class="fortab prepaids2">列表显示</li>
    </ul>
</div>
<div>
    <div class="tablelist showdomdiv showsss">

        <div id="mapMonitor_div">

        </div>
    </div>
    <div class="tablelist hidedomdiv showsss">
        <div id="listMonitor_div">
            <div id="listMonitor_top">
                <ul id="listMonitor_ul">
                    <li>站点选择</li>
                    <li><select id="stationID"><option value="0">所有站点</option>
                        <option th:each="station:${stationList}" th:value="${station.id}"
                                th:text="${station.name}"></option>
                    </select></li>
                    <li>设备类型</li>
                    <li><select id="type"><option value="0">所有类型</option>
                        <option th:each="deviceType:${deviceTypeList}" th:value="${deviceType.id}"
                                th:text="${deviceType.name}"></option>
                    </select></li>
                    <li>设备选择</li>
                    <li><select id="deviceID"><option value="0">所有设备</option></select></li>
                </ul>
            </div>
            <div id="listMonitor_height">
                <table width="100%" border="0" id="Monitor">
                    <thead>
                    <tr>
                        <th class="tips">线路名称</th>
                        <th class="tips">车站名称</th>
                        <th class="tips">设备名称</th>
                        <th class="tips">状态</th>
                        <th class="tips">IP地址</th>
                        <th class="tips">位置</th>
                    </tr>
                    </thead>
                    <tr>

                    </tr>
                </table>
                <div id="paging_div">
                    <ul id="paging_ul">
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
<script language="JavaScript" src="/js/jquery.js"></script>
<script type="text/javascript">
$(document).ready(function(){
    selectMonitor();
    // 改为鼠标移上的事件只需把click改为mousemove
    $(".fortab").click(function(){
        var number=$(".fortab").index(this);
        $(this).addClass("checked");
        $(this).siblings().removeClass("checked");
        $(".tablelist:eq("+number+")").show();
        $(".tablelist:eq("+number+")").siblings().hide();
    });

    $("#Monitor tr").live("click",function(){
        var trs = $(this).parent().find('tr'); //获取所有tr
        if(trs.hasClass('on')){ //判断这些tr 有没有Class ‘on’’
            trs.removeClass('on');//把class on 移除
        }
        $(this).addClass('on');//点击的tr 添加 on class 用于改变样式
    });

    $("#stationID").change(function () {
        var type=$("#type").val();
        selectMonitor($(this).val(),type);
    });
    $("#type").change(function () {
        var stationID=$("#stationID").val();
        selectMonitor(stationID,$(this).val());
    });

});

function selectMonitor(stationID,type) {
    var lineName;
    var stationName;
    var devicePosName;
    $.ajax({
        url:'/Device/selectMonitor',
        type:"POST",
        data:{stationID:stationID,type:type},
        success:function (data) {
            $("#Monitor tbody tr").remove();
            $.each(data.pageUtil.pageData, function (i, item) {
                $.each(data.lineList, function (j, line) {
                    if(item.lineID==line.id){
                        lineName=line.name;
                    }
                });
                $.each(data.stationList, function (k, station) {
                    if(item.stationID==station.id){
                        stationName=station.name;
                    }
                });
                $.each(data.devicePosList, function (t, devicePos) {
                    if(item.devicePosID==devicePos.id){
                        devicePosName=devicePos.name;
                    }
                });

                $("#Monitor tbody").prepend('<tr><td hidden="hidden">'+item.id+'</td>'+
                    '<td>'+lineName+'</td>' +
                    '<td>'+stationName+'</td>' +
                    '<td>'+item.name+'</td>'+
                     '<td>-1</td>'+
                     '<td>'+item.ip+'</td>'+
                     '<td>'+devicePosName+'</td></tr>');
            });

            $("#Monitor thead tr .sopt").remove();
            $.each(data.deviceSpotList, function (j, line) {
                $("#Monitor thead tr").append('<th class="tips sopt">'+line.name+'</th>');
            });

            $('#Monitor tbody tr').each(function(i){
               var object=$(this);
                $.each(data.list, function (t, list) {
                    if(list.deviceID==$(object).children('td').eq(0).text()){
                        $.each(list,function(k,v){
                            if(k!="deviceID"){
                                if(k=="state"){
                                    $(object).children('td').eq(4).text(v);
                                }else{
                                    $(object).append('<td>'+v+'</td>');
                                }
                            }
                        });
                    }
                });
            });

            $("#paging_ul li").remove();
            $("#paging_ul").prepend('<li><span>当前页数:</span></li>' +
                '<li><span>'+data.pageUtil.pageNum+'</span>/<span>'+data.pageUtil.maxPage+'</span></li>');
            if(data.pageUtil.pageNum>=2){
                $(".notPreviousPage").remove();
                $("#paging_ul").prepend('<li><input type="button" value="上一页" class="isPreviousPage" onclick="previousPage('+data.pageUtil.pageNum+')"></li>');
            }else{
                $(".isPreviousPage").remove();
                $("#paging_ul").prepend('<li><input type="button" value="上一页" class="notPreviousPage" disabled="disabled"></li>');
            }

            if(data.pageUtil.pageNum<data.pageUtil.maxPage){
                $(".notNextPage").remove();
                $("#paging_ul").append('<li><input type="button" value="下一页" class="isNextPage" id="nextPage" onclick="nextPage('+data.pageUtil.pageNum+')"></li>');
            }else{
                $(".isNextPage").remove();
                $("#paging_ul").append('<li><input type="button" value="下一页" class="notNextPage" id="nextPage" disabled="disabled"></li>');
            }
        }
    });
}

function selectMonitorType(){
    $('#Monitor tbody tr').each(function(i){
        var object=$(this);
        var deviceID=$(this).children('td').eq(0).text();
        $.ajax({
            url:'/Device/selectMonitorType',
            type:"POST",
            data:{id:deviceID},
            success:function (data) {
                var count=0;
                $(object).children('td').each(function(j){
                    if(j==4){
                        if(data.map.state==1){
                            $(this).text("正常");
                        }else{
                            $(this).text("异常");
                            $(this).css("color","red");
                        }
                        $(this).text();
                    }

                    if(j>=7){
                        var Subnode=$(this);
                        $.each(data.map,function(k,v){
                            if("para"+count==k){
                                $(Subnode).text(v);
                            }
                        });
                        count++;
                        if($(this).text()==-1){
                            $(this).text("出现异常");
                            $(this).css("color","red");
                        }
                    }

                });
            }
        });

    });
}

objTimer = window.setInterval(function(){
    selectMonitorType();
},10000);

function nextPage(pageNum) {
    location.href="/standbyType/standbyTypeManagement?pageNum="+pageNum;
}
function previousPage(pageNum) {
    location.href="/standbyType/standbyTypeManagement?pageNum="+pageNum;
}
</script>
</body>
</html>